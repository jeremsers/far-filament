---
import { getCollection } from "astro:content";
import BlogLayout from "../../layouts/baselayout/BlogLayout.astro";

// G√©n√®re les routes statiques pour tous les articles
export async function getStaticPaths() {
	const blogEntries = await getCollection("blog");
	return blogEntries.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Formatage de la date
const formattedDate = new Date(entry.data.pubDate).toLocaleDateString("fr-FR", {
	year: "numeric",
	month: "long",
	day: "numeric",
});
---

<BlogLayout
	title={entry.data.title}
	description={entry.data.description}
	image={entry.data.image}
	pubDate={entry.data.pubDate}
	author={entry.data.author}
>
	<article class="blog-post">
		<div class="post-header">
			{
				entry.data.image && (
					<div class="post-image">
						<img src={entry.data.image} alt={entry.data.title} />
					</div>
				)
			}
			<div class="post-meta">
				<h1>{entry.data.title}</h1>
				<div class="post-info">
					<span class="date">
						<span class="icon">üìÖ</span>
						{formattedDate}
					</span>
					<span class="author">
						<span class="icon">‚úçÔ∏è</span>
						{entry.data.author}
					</span>
					<span class="category">
						<span class="icon">üìÇ</span>
						{entry.data.category}
					</span>
				</div>
				<div class="tags">
					{entry.data.tags.map((tag: string) => <span class="tag">#{tag}</span>)}
				</div>
			</div>
		</div>

		<div class="post-content">
			<Content />
		</div>

		<div class="post-footer">
			<div class="share-buttons">
				<h3>Partager cet article</h3>
				<div class="social-share">
					<a
						href={`https://twitter.com/intent/tweet?text=${entry.data.title}&url=${Astro.url}`}
						target="_blank"
						rel="noopener noreferrer"
						class="share-button twitter"
					>
						Twitter
					</a>
					<a
						href={`https://www.linkedin.com/shareArticle?mini=true&url=${Astro.url}&title=${entry.data.title}`}
						target="_blank"
						rel="noopener noreferrer"
						class="share-button linkedin"
					>
						LinkedIn
					</a>
					<a
						href={`https://www.facebook.com/sharer/sharer.php?u=${Astro.url}`}
						target="_blank"
						rel="noopener noreferrer"
						class="share-button facebook"
					>
						Facebook
					</a>
				</div>
			</div>
		</div>
	</article>
</BlogLayout>

<style lang="scss">
	.blog-post {
		max-width: 800px;
		margin: 0 auto;
		padding: 40px 20px;

		.post-header {
			margin-bottom: 40px;

			.post-image {
				margin-bottom: 30px;
				border-radius: 15px;
				overflow: hidden;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);

				img {
					width: 100%;
					height: auto;
					display: block;
				}
			}

			h1 {
				font-size: 2.5em;
				color: #2c3e50;
				margin-bottom: 20px;
			}

			.post-info {
				display: flex;
				flex-wrap: wrap;
				gap: 20px;
				margin-bottom: 15px;
				color: #666;
				font-size: 0.9em;

				span {
					display: flex;
					align-items: center;
					gap: 5px;

					.icon {
						font-size: 1.2em;
					}
				}
			}

			.tags {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				margin-top: 15px;

				.tag {
					background-color: #f8ede3;
					color: #6b8e23;
					padding: 5px 10px;
					border-radius: 5px;
					font-size: 0.9em;
					transition: transform 0.3s ease;

					&:hover {
						transform: translateY(-2px);
					}
				}
			}
		}

		.post-content {
			line-height: 1.8;
			color: #2c3e50;

			:global(h2) {
				color: #2c3e50;
				font-size: 1.8em;
				margin: 40px 0 20px;
				position: relative;

				&:after {
					content: "";
					position: absolute;
					bottom: -10px;
					left: 0;
					width: 40px;
					height: 3px;
					background-color: #6b8e23;
					border-radius: 2px;
				}
			}

			:global(p) {
				margin-bottom: 20px;
			}

			:global(ul) {
				margin-bottom: 20px;
				padding-left: 20px;

				li {
					margin-bottom: 10px;
				}
			}

			:global(strong) {
				color: #2c3e50;
			}
		}

		.post-footer {
			margin-top: 60px;
			padding-top: 30px;
			border-top: 1px solid #eee;

			.share-buttons {
				text-align: center;

				h3 {
					color: #2c3e50;
					margin-bottom: 20px;
					font-size: 1.2em;
				}

				.social-share {
					display: flex;
					justify-content: center;
					gap: 15px;

					.share-button {
						padding: 10px 20px;
						border-radius: 5px;
						color: white;
						text-decoration: none;
						transition: transform 0.3s ease;

						&:hover {
							transform: translateY(-2px);
						}

						&.twitter {
							background-color: #1da1f2;
						}

						&.linkedin {
							background-color: #0077b5;
						}

						&.facebook {
							background-color: #4267b2;
						}
					}
				}
			}
		}
	}

	@media (max-width: 768px) {
		.blog-post {
			padding: 20px;

			.post-header {
				h1 {
					font-size: 2em;
				}

				.post-info {
					flex-direction: column;
					gap: 10px;
				}
			}

			.post-footer {
				.social-share {
					flex-wrap: wrap;
				}
			}
		}
	}
</style>

